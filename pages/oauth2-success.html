<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OAuth2 Success</title>
</head>
<body style="background-color: #111; color: white; font-family: sans-serif; text-align: center; padding-top: 100px;">
<h2>Redirecting to main page...</h2>
<script>
    const params = new URLSearchParams(window.location.search);
    const token = params.get("token");

    if (token) {
        localStorage.setItem("token", token);

        fetch("http://localhost:8189/users/info", {
            method: "GET",
            headers: {
                "Authorization": "Bearer " + token
            }
        })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    localStorage.setItem("username", data.payload.username);
                    localStorage.setItem("email", data.payload.email);
                    localStorage.setItem("role", data.payload.roles?.[0]?.name || "User");
                }

                window.location.replace(window.location.origin + "/index.html");
            })
            .catch(err => {
                console.error("Error:", err);
                window.location.href = "index.html";
            });
    } else {
        document.body.innerText = "Token not found in URL";
    }
</script>

</body>
</html>
