<!DOCTYPE html>
<html lang="en">
<head>
    <title>Post-Wave demo</title>
    <meta charset="utf-8">
    <link rel="icon" href="images/icons8-favicon-64.png" type="image/x-icon">
    <link rel="shortcut icon" href="images/icons8-favicon-64.png" type="image/x-icon" />
    <!-- Подключаем Font Awesome для иконок -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="css/prettyPhoto.css">
    <link rel="stylesheet" type="text/css" media="screen" href="css/style.css">
    <link rel="stylesheet" type="text/css" media="screen" href="css/tms.css">
    <link rel="stylesheet" type="text/css" href="css/latest-posts.css">
    <script type="text/javascript" src="js/jquery-1.7.min.js"></script>
    <script type="text/javascript" src="js/superfish.js"></script>
    <script type="text/javascript" src="js/jquery.easing.1.3.js"></script>
    <script type="text/javascript" src="js/tms-0.4.1.js"></script>
    <script type="text/javascript" src="js/jquery.prettyPhoto.js"></script>
    <script type="text/javascript" src="js/hover-image.js"></script>
    <script>
        $(function(){
            $('.slider')._TMS({
                prevBu:false,
                nextBu:false,
                playBu:false,
                duration:800,
                easing:'easeOutQuad',
                preset:'diagonalFade',
                pagination:true,
                pagNums:false,
                slideshow:7000,
                numStatus:false,
                banners:'fade',
                waitBannerAnimation:false,
                progressBar:false
            });
        });
    </script>
    <!--[if lt IE 8]>
    <div style=' clear: both; text-align:center; position: relative;'>
        <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
            <img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0000_us.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." />
        </a>
    </div>
    <![endif]-->
    <!--[if lt IE 9]>
    <script type="text/javascript" src="js/html5.js"></script>
    <link rel="stylesheet" type="text/css" media="screen" href="css/ie.css">
    <![endif]-->
</head>
<body>
<!-- Прелоадер -->
<div id="preloader">
    <div class="cube-grid">
        <div class="cube cube1"></div>
        <div class="cube cube2"></div>
        <div class="cube cube3"></div>
        <div class="cube cube4"></div>
        <div class="cube cube5"></div>
        <div class="cube cube6"></div>
        <div class="cube cube7"></div>
        <div class="cube cube8"></div>
        <div class="cube cube9"></div>
    </div>
</div>

<div class="main">
    <!--==============================header=================================-->
    <header>
        <div class="top">
            <div class="nav">
                <ul class="sf-menu">
                    <li><a href="index.html">home</a></li>
                    <li><a target="_blank" href="https://nick8787.github.io/post-wave-documentation/">documentation</a></li>
                    <li><a target="_blank" href="https://www.udemy.com/user/mykola-shchypailo/">udemy-courses</a></li>
                    <li><a href="#">community</a></li>
                    <li><a href="contatcs.html">contacts</a></li>
                </ul>
            </div>
            <div class="login" id="auth-container">
                <div id="auth-links">
                    You have not yet registered to our club? &nbsp;&nbsp;
                    <a href="register-page.html" id="register-link">Register</a> &nbsp;&nbsp; or &nbsp;&nbsp;
                    <a href="login-page.html" id="login-link">Log in</a>
                </div>
                <div id="welcome-message" style="display: none;">
                    Welcome on board, <span id="greeting"></span>!
                    &nbsp;&nbsp;<a href="#" id="logout-link">Logout</a>
                </div>
            </div>
            <div class="clear"></div>
        </div>
        <div class="middle">
            <h1><a class="logo" href="index.html"><span>Post</span>Wave</a></h1>
            <a href="index.html" class="h_banner"></a>
        </div>
        <nav>
            <ul class="sf-menu">
                <li class="current f_item"><a href="index.html">HOME</a></li>
                <li><a href="my-posts.html">MY POSTS</a></li>
                <li><a href="my-comments.html">MY COMMENTS</a></li>
                <li><a >ACTIONS</a>
                    <ul>
                        <li><a href="create-user.html">Create user</a></li>
                        <li><a href="create-post.html">Create post</a></li>
                        <li><a href="create-comment.html">Create comment</a></li>
                        <li><a href="get-list-of-users.html">Get list of users</a></li>
                    </ul>
                </li>
                <li><a href="actions.html">LOGS</a></li>
                <li><a href="my-account.html">MY ACCOUNT</a></li>
            </ul>
            <form id="search" onsubmit="return handleSearch(event)" accept-charset="utf-8" style="position: relative;">
                <label for="search-query"></label><input type="text" id="search-query" name="s" placeholder="Enter search term..." />
                <button type="submit" class="button1">Search</button>
                <!-- Pop-up -->
                <div id="search-popup" style="display: none; position: absolute; top: 100%; left: 0; background-color: rgba(255, 255, 255, 0.95); color: #333; padding: 10px 15px; border-radius: 8px; margin-top: 5px; font-size: 12px; z-index: 1000; box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.15); border: 1px solid #ddd; white-space: nowrap;">
                    <i class="fas fa-info-circle" style="vertical-align: middle; line-height: 1;"></i>
                    <span style="vertical-align: middle;">Search functionality not implemented yet</span>
                </div>
            </form>
            <div id="search-results"></div>
            <div class="clear"></div>
        </nav>
    </header>
    <!-- slider -->
    <div id="slider">
        <div class="slider">
            <ul class="items">
                <li>
                    <img src="images/slider/slide1-1.svg" width="640" height="385" alt="slide1" />
                    <div class="banner">
                        <div class="title1">Project Documentation</div>
                        <div class="title2">Learn More About the Project</div>
                        <p>
                            Explore the full project documentation at
                            <a href="https://nick8787.github.io/post-wave-documentation/" class="pulsing-text" target="_blank">this link</a>. You can also view information about GitLab CI/CD, Docker Hub, Swagger, and more.
                        </p><br><br><br><br><br>
                        <div class="but_wrap">
                            <a href="#" class="button2">read more</a>
                        </div>
                    </div>
                </li>

                <li>
                    <img src="images/slider/slide1-2.svg" width="640" height="385" alt="slide2" />
                    <div class="banner">
                        <div class="title1">Functionality</div>
                        <div class="title2">Functionality of this project</div>
                        <p>
                            This project enables users to register, create posts and comments, and search for all actions performed by the user.
                            <br>The frontend is available on
                            <a href="https://github.com/nick8787/post-wave-documentation" target="_blank" class="pulsing-text">GitHub</a>, and the backend,
                            including API documentation, Docker setup, and microservices code, can be found on
                            <a href="https://nick8787.github.io/post-wave-documentation/" target="_blank" class="pulsing-text">this page</a>.
                        </p>
                        <div class="but_wrap">
                            <a href="#" class="button2">read more</a>
                        </div>
                    </div>
                </li>

                <li>
                    <img src="images/slider/slide1-3.svg" width="640" height="385" alt="slide3" />
                    <div class="banner">
                        <div class="title1">About me</div>
                        <div class="title2">A Few Words About Me</div>
                        I have over 4 years of experience as a QA Automation Engineer, specializing in Web, API, and Mobile testing.

                        <br><br>Currently, I am expanding my expertise into backend development, focusing on Java, Spring Boot, JWT, Security, Nginx, CORS, and Kafka.
                        <div class="but_wrap">
                            <br><br><a href="#" class="button2">read more</a>
                        </div>
                    </div>
                </li>
                <li>
                    <img src="images/slider/slide1-4.svg" width="640" height="385" alt="slide4" />
                    <div class="banner">
                        <div class="title1">Contact</div>
                        <div class="title2">Contact with me</div>
                        If you want to get in touch with me, feel free to use the following platforms:
                        <br><br>
                        <ul class="icon-links">
                            <li>
                                <i class="fab fa-linkedin"></i> :
                                <a href="https://www.linkedin.com/in/mykola-shchypailo-284997297/" target="_blank" class="pulsing-text">LinkedIn</a>
                            </li>
                            <li>
                                <i class="fab fa-github"></i> :
                                <a href="https://github.com/nick8787" target="_blank" class="pulsing-text">GitHub</a>
                            </li>
                            <li>
                                <i class="fab fa-gitlab"></i> :
                                <a href="https://gitlab.com/post_wave-project" target="_blank" class="pulsing-text">GitLab</a>
                            </li>
                        </ul>
                    </div>

                </li>
            </ul>
        </div>
    </div>
    <!-- slider-end -->
    <!--==============================content================================-->
    <section id="content">
        <div class="container_12">
            <div class="wrapper">
                <!-- Latest Posts Section -->
                <article class="grid_8">
                    <div class="box">
                        <h2 class="first">Latest Posts</h2>
                        <div class="sub_box">
                            <!-- Preloader for Latest Posts -->
                            <div id="latest-posts-preloader" class="latest-posts-preloader">
                                <div class="loader">
                                    <div class="loader-bar"></div>
                                    <div class="loader-bar"></div>
                                    <div class="loader-bar"></div>
                                    <div class="loader-bar"></div>
                                </div>
                            </div>
                            <ul class="ext_list topics" id="latest-posts">
                                <!-- Posts will be dynamically loaded here -->
                            </ul>
                            <div class="post-footer">
                                <div id="view-all-container" class="view-all-container">
                                    <a href="list-of-all-posts.html" class="link2">View All List of Posts</a>
                                </div>
                                <div id="post-info-container" class="post-info-container">
                                    <!-- Here information about the total posts will be displayed -->
                                </div>
                            </div>
                        </div>
                    </div>
                </article>

                <!-- Latest Comments Section -->
                <article class="grid_4">
                    <div class="box">
                        <h2 class="first">Latest Comments</h2>
                        <div class="sub_box">
                            <!-- Preloader for Latest Comments -->
                            <div id="latest-comments-preloader" class="latest-posts-preloader">
                                <div class="loader">
                                    <div class="loader-bar"></div>
                                    <div class="loader-bar"></div>
                                    <div class="loader-bar"></div>
                                    <div class="loader-bar"></div>
                                </div>
                            </div>
                            <ul class="ext_list comments" id="latest-comments">
                                <!-- Comments will be dynamically loaded here -->
                            </ul>
                            <div id="comments-info-container" class="post-info-container">
                                <!-- Here information about the total comments will be displayed -->
                            </div>
                        </div>
                    </div>

                    <!-- Latest Users Section -->
                    <div class="box">
                        <h2 class="first">Latest Users</h2>
                        <div class="sub_box">
                            <ul class="ext_list latest_r video">
                                <li class="m_bottom_zero">
                                    <div class="ext_box review">
                                        <figure><a class="lightbox-video" href="flash/video_AS3.swf?width=512&amp;height=288&amp;fileVideo=intro06.flv" data-gal="prettyPhoto"><img src="images/latest3.jpg" alt="" /></a></figure>
                                        <div>
                                            <h3 class="ind2">XBOX 360</h3>
                                            <h4 class="ind">ipsum dolor sit amet conse</h4>
                                        </div>
                                    </div>
                                    <div class="text"><a href="#">Lorem ipsum dolor sit amet conse ctetur.</a></div>
                                </li>
                            </ul>
                            <a href="#" class="link1">see all</a>
                        </div>
                    </div>
                </article>
            </div>
        </div>
    </section>

    <aside>
        <div class="container_12">
            <div class="wrapper">
                <article class="grid_4">
                    <h5>About project</h5>
                    <p class="green p2">Этот проект ипсользует Java 17, Spring Boot 2.7.12, Docker hub for deploy, PostgreSQL database, CORS configuration. It consists of 4 microservices</p>
                    Lorem ipsum dolor sit amet conse ctetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.<br>
                    <a href="#" class="link2">read more</a>
                </article>
                <article class="grid_4">
                    <h5>access and restrictions</h5>
                    <p class="green p3">Dolor sit amet conse ctetur adipisicing elit, sed do eiusmod tempor incididunt ut labore.</p>
                    <p class="p3">Lorem ipsum dolor sit amet conse ctetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. </p>
                    Lorem ipsum dolor sit amet conse ctetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim.<br>
                    <a href="#" class="link2 b_ind">read more</a>
                </article>
                <article class="grid_4">
                    <h5>top games:</h5>
                    <ul class="games_list">
                        <li>
                            <span class="green">XBOX 360</span><br>
                            <a href="#">Lorem ipsum dolor sit amet conse ctetur adipisicing elit, sed do eiusmod tempor</a>
                        </li>
                        <li>
                            <span class="green">Mobile</span><br>
                            <a href="#">Dolor sit amet conse ctetur adipisicing elit, sed do eiusmod tempor</a>
                        </li>
                        <li class="last bd_none">
                            <span class="green">XBOX 360</span><br>
                            <a href="#">Sit amet conse ctetur adipisicing elit</a>
                        </li>
                    </ul>
                    <a href="#" class="link2">read more</a>
                </article>
            </div>
        </div>
    </aside>
    <!--==============================footer=================================-->
    <footer>
        <div class="menu">
            <a href="#">home</a>
            <a href="#">reviews</a>
            <a href="#">news</a>
            <a href="#">videos</a>
            <a href="#">blog</a>
            <a href="#">contacts</a>
        </div>
        <div class="privacy">
            <a href="index.html"><img src="images/logo/logo7.svg" width="74" height="35" alt="f_logo" /></a>
            &nbsp; &nbsp;<span>© 2024 &nbsp; &nbsp;&nbsp; <a href="index-2.html">Privacy Policy</a></span><br>
            <!-- {%FOOTER_LINK} -->
        </div>
    </footer>
</div>

<script>
    // Скрипт для скрытия прелоадера после полной загрузки страницы
    window.addEventListener('load', function() {
        const preloader = document.getElementById('preloader');
        preloader.style.display = 'none';
    });

    // Fetch and display latest posts
    document.addEventListener("DOMContentLoaded", function() {
        const latestPostsContainer = document.getElementById('latest-posts');
        const preloader = document.getElementById('latest-posts-preloader');
        const postInfoContainer = document.getElementById('post-info-container');
        const token = localStorage.getItem('token');

        // Show preloader and hide posts container
        latestPostsContainer.style.display = 'none';
        preloader.style.display = 'flex';

        fetch('https://post-wave-swagger.fun/posts/all', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(response => response.json())
            .then(data => {
                preloader.style.display = 'none'; // Hide preloader after data is loaded
                if (data.success && data.payload.length > 0) {
                    const sortedPosts = data.payload.sort((a, b) => {
                        const dateA = new Date(a.created[0], a.created[1] - 1, a.created[2], a.created[3], a.created[4], a.created[5]);
                        const dateB = new Date(b.created[0], b.created[1] - 1, b.created[2], b.created[3], b.created[4], b.created[5]);
                        return dateB - dateA;
                    });

                    // Display only the latest three posts
                    sortedPosts.slice(0, 3).forEach(post => {
                        const createdDate = new Date(Date.UTC(post.created[0], post.created[1] - 1, post.created[2], post.created[3], post.created[4], post.created[5])).toLocaleString('en-GB', {
                            day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit'
                        });

                        const postItem = `
<li class="latest-post-item">
    <figure>
        <a href="post.html?id=${post.id}">
            <img src="${post.image}" alt="${post.title}" class="latest-post-image" onerror="this.onerror=null;this.src='images/here-your-photo.png';" />
        </a>
    </figure>
    <div class="latest-post-details">
        <h3 class="latest-post-title"><a href="post.html?id=${post.id}" style="text-decoration: none; color: inherit;">${post.title}</a></h3>
        <p class="latest-post-content">${post.content.substring(0, 50)}...</p>
        <p class="latest-post-comments">The number of comments: ${post.commentsCount || 0}</p>
        <p class="latest-post-author">Created by: ${post.owner.username}</p>
        <p class="latest-post-date">Created on: ${createdDate}</p>
    </div>
</li>
`;
                        latestPostsContainer.insertAdjacentHTML('beforeend', postItem);
                    });

                    // Display the posts container after loading the data
                    latestPostsContainer.style.display = 'block';

                    // Display the number of posts and information about displaying the latest 3 posts
                    postInfoContainer.textContent = `Total posts: ${data.payload.length}. Displaying latest 3.`;
                } else {
                    latestPostsContainer.innerHTML = '<li>No recent posts available.</li>';
                    latestPostsContainer.style.display = 'block';
                }
            })
            .catch(error => {
                console.error('Error fetching posts:', error);
                preloader.style.display = 'none';
                latestPostsContainer.innerHTML = '<li>Error loading posts. Please try again later.</li>';
                latestPostsContainer.style.display = 'block';
            });
    });

    // Fetch and display latest comments
    document.addEventListener("DOMContentLoaded", function() {
        const latestCommentsContainer = document.getElementById('latest-comments');
        const commentInfoContainer = document.getElementById('comments-info-container'); // Updated ID to match the HTML

        fetch('https://post-wave-swagger.fun/comments/all', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                if (data.success && data.payload.length > 0) {
                    const sortedComments = data.payload.sort((a, b) => {
                        const dateA = new Date(a.created[0], a.created[1] - 1, a.created[2], a.created[3], a.created[4], a.created[5]);
                        const dateB = new Date(b.created[0], b.created[1] - 1, b.created[2], b.created[3], b.created[4], b.created[5]);
                        return dateB - dateA;
                    });

                    // Display only the latest two comments
                    sortedComments.slice(0, 2).forEach(comment => {
                        const createdDate = new Date(Date.UTC(comment.created[0], comment.created[1] - 1, comment.created[2], comment.created[3], comment.created[4], comment.created[5])).toLocaleString('en-GB', {
                            day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit'
                        });

                        const commentItem = `
                    <li class="latest-comment-item">
                        <div class="latest-comment-avatar"></div>
                        <div class="latest-comment-details">
                            <p class="latest-comment-text">${comment.message.substring(0, 50)}...</p>
                            <p class="latest-comment-author">Created by: ${comment.owner.username}</p>
                            <p class="latest-comment-date">Created on: ${createdDate}</p>
                        </div>
                    </li>
                `;
                        latestCommentsContainer.insertAdjacentHTML('beforeend', commentItem);
                    });

                    // Display the number of comments and information
                    commentInfoContainer.textContent = `Total comments: ${data.payload.length}. Displaying latest 2.`;
                } else {
                    latestCommentsContainer.innerHTML = '<li>No recent comments available.</li>';
                }
            })
            .catch(error => {
                console.error('Error fetching comments:', error);
                latestCommentsContainer.innerHTML = '<li>Error loading comments. Please try again later.</li>';
            })
            .finally(() => {
                const preloader = document.getElementById('latest-comments-preloader');
                if (preloader) {
                    preloader.style.display = 'none'; // Ensure preloader is hidden after load
                }
            });
    });

    function handleSearch(event) {
        event.preventDefault();
        const popup = document.getElementById('search-popup');

        // Показываем попап
        popup.style.display = 'block';

        // Скрываем попап через 3 секунды
        setTimeout(() => {
            popup.style.display = 'none';
        }, 3000);
    }

    // Auth and logout handling
    document.addEventListener("DOMContentLoaded", function() {
        const username = localStorage.getItem('username');
        const token = localStorage.getItem('token');

        if (username && token) {
            document.getElementById('auth-links').style.display = 'none';
            document.getElementById('welcome-message').style.display = 'block';
            document.getElementById('greeting').textContent = username;
        } else {
            document.getElementById('auth-links').style.display = 'block';
            document.getElementById('welcome-message').style.display = 'none';
        }

        document.getElementById('logout-link').addEventListener('click', function() {
            localStorage.removeItem('username');
            localStorage.removeItem('token');
            window.location.reload();
        });
    });
</script>

</body>
</html>
